<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>UARL Perceptual Mapper (Academic Edition)</title>
    <style>
        body { font-family: 'Helvetica', 'Arial', sans-serif; background: #ffffff; color: #111; display: flex; padding: 0; margin: 0; height: 100vh; overflow: hidden; }
        #sidebar { width: 380px; background: #f7f7f7; padding: 25px; border-right: 1px solid #ddd; overflow-y: auto; height: 100%; z-index: 10; }
        #viewer { flex-grow: 1; display: flex; flex-direction: column; justify-content: center; align-items: center; position: relative; background: #fff; }
        canvas { border: 1px solid #eee; background: #fff; }
        .input-group { margin-bottom: 12px; background: #fff; padding: 12px; border-radius: 4px; border: 1px solid #eee; }
        label { display: block; font-size: 0.75em; margin-bottom: 5px; color: #666; text-transform: uppercase; font-weight: bold; }
        input { width: 100%; background: #fff; border: 1px solid #ccc; color: #111; padding: 8px; border-radius: 4px; box-sizing: border-box; outline: none; }
        input:focus { border-color: #000; }
        .btn-main { width: 100%; padding: 12px; background: #111; border: none; font-weight: bold; cursor: pointer; border-radius: 4px; color: #fff; margin-top: 5px; }
        .btn-save { width: 100%; padding: 10px; background: transparent; border: 1px solid #111; color: #111; cursor: pointer; border-radius: 4px; margin-top: 10px; }
        .emotion-item { display: flex; align-items: center; background: #fff; margin: 8px 0; padding: 10px; border-radius: 4px; border: 1px solid #eee; border-left: 6px solid var(--e-color); }
        .emotion-item input[type="checkbox"] { width: auto; margin-right: 12px; }
        .remove-btn { color: #cc0000; cursor: pointer; margin-left: auto; font-size: 1.1em; }
        h2 { margin-top: 0; font-size: 1.1em; border-bottom: 2px solid #111; padding-bottom: 10px; }
        .p-val-desc { font-size: 0.65em; color: #888; margin-top: 4px; line-height: 1.2; }
    </style>
</head>
<body>

<div id="sidebar">
    <h2>Ross' Technique Input</h2>
    <div class="input-group">
        <label>Affective Noun</label>
        <input type="text" id="newName" placeholder="e.g., Alarmed">
    </div>
    <div class="input-group">
        <label>Angle (Degrees: 0-360°)</label>
        <input type="number" id="newAngle" value="0" min="0" max="360">
    </div>
    <div class="input-group">
        <label>Precision (P-Value / SD)</label>
        <input type="number" id="newP" value="0.85" step="0.01" min="0" max="1">
        <div class="p-val-desc">
            The consensus value (P) as defined in Ross (1938). 
            Higher P (near 1.0) = High Consensus (Sharp). 
            Lower P (near 0.1) = Fuzzy Set (Broad).
        </div>
    </div>
    <div class="input-group">
        <label>Hex Color</label>
        <input type="color" id="newColor" value="#000000">
    </div>
    <button class="btn-main" onclick="addEmotion()">PLOT COORDINATE</button>

    <h2 style="margin-top: 40px;">Active Dictionary</h2>
    <div id="emotionList"></div>
    <button class="btn-save" onclick="saveImage()">EXPORT FOR MANIFESTO (.PNG)</button>
</div>

<div id="viewer">
    <canvas id="canvas"></canvas>
    <div style="margin-top: 25px; color: #aaa; font-size: 0.7em; letter-spacing: 3px; font-weight: bold;">LINGUA ROBOTICA | PERCEPTUAL FIELD MAP</div>
</div>

<script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const listEl = document.getElementById('emotionList');
    let emotions = [];

    function resize() {
        const size = Math.min(window.innerWidth - 450, window.innerHeight - 150);
        canvas.width = size;
        canvas.height = size;
        draw();
    }
    window.onresize = resize;
    resize();

    function addEmotion() {
        const e = {
            id: Date.now(),
            name: document.getElementById('newName').value || 'Unknown',
            angle: parseFloat(document.getElementById('newAngle').value),
            p: parseFloat(document.getElementById('newP').value),
            color: document.getElementById('newColor').value,
            visible: true
        };
        emotions.push(e);
        updateSidebar();
        draw();
    }

    function updateSidebar() {
        listEl.innerHTML = '';
        emotions.forEach(e => {
            const div = document.createElement('div');
            div.className = 'emotion-item';
            div.style.setProperty('--e-color', e.color);
            div.innerHTML = `
                <input type="checkbox" ${e.visible ? 'checked' : ''} onchange="toggle(${e.id})">
                <span style="font-weight:bold">${e.name}</span>
                <span style="font-size:0.7em; margin-left:10px; color:#888">${e.angle}°</span>
                <span class="remove-btn" onclick="remove(${e.id})">×</span>
            `;
            listEl.appendChild(div);
        });
    }

    function toggle(id) {
        const e = emotions.find(x => x.id === id);
        e.visible = !e.visible;
        draw();
    }

    function remove(id) {
        emotions = emotions.filter(x => x.id !== id);
        updateSidebar();
        draw();
    }

    function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        const cx = canvas.width / 2;
        const cy = canvas.height / 2;
        const radius = canvas.width * 0.4;

        // Draw Circumplex Infrastructure
        ctx.strokeStyle = '#ddd';
        ctx.lineWidth = 1;
        ctx.beginPath();
        ctx.arc(cx, cy, radius, 0, Math.PI * 2);
        ctx.stroke();

        // Quadrant Axes
        ctx.strokeStyle = '#eee';
        ctx.beginPath(); ctx.moveTo(cx - radius, cy); ctx.lineTo(cx + radius, cy); ctx.stroke();
        ctx.beginPath(); ctx.moveTo(cx, cy - radius); ctx.lineTo(cx, cy + radius); ctx.stroke();

        // Labeling Axes
        ctx.fillStyle = '#bbb';
        ctx.font = 'bold 10px Helvetica';
        ctx.fillText('HIGH AROUSAL', cx - 35, cy - radius - 15);
        ctx.fillText('LOW AROUSAL', cx - 35, cy + radius + 25);
        ctx.fillText('PLEASANT', cx + radius + 15, cy + 4);
        ctx.fillText('UNPLEASANT', cx - radius - 85, cy + 4);

        emotions.forEach(e => {
            if (!e.visible) return;

            // In Russell 1980, 0 degrees is "Pleasant" (the 3 o'clock position on canvas)
            const rad = (e.angle * Math.PI) / 180;
            
            // MATH: Translate P-value (0-1) to Angular Spread
            // High P (1.0) = 0 spread (a line). Low P (0.1) = 45 degree spread.
            const spread = (1.1 - e.p) * 0.6; 

            // 1. Draw the "Fuzzy Set" Wedge
            // We use a linear gradient for a clean, academic "sector" look
            const grad = ctx.createRadialGradient(cx, cy, 0, cx, cy, radius);
            grad.addColorStop(0, 'rgba(255,255,255,0)');
            grad.addColorStop(0.2, e.color + '11');
            grad.addColorStop(1, e.color + '44'); // Subtle 25% alpha

            ctx.fillStyle = grad;
            ctx.beginPath();
            ctx.moveTo(cx, cy);
            ctx.arc(cx, cy, radius, rad - spread, rad + spread);
            ctx.closePath();
            ctx.fill();

            // 2. Draw the Primary Vector (Consensus Line)
            ctx.strokeStyle = e.color;
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(cx, cy);
            ctx.lineTo(cx + Math.cos(rad) * radius, cy + Math.sin(rad) * radius);
            ctx.stroke();

            // 3. Label Point
            ctx.fillStyle = e.color;
            ctx.beginPath();
            ctx.arc(cx + Math.cos(rad) * radius, cy + Math.sin(rad) * radius, 3, 0, Math.PI*2);
            ctx.fill();

            ctx.fillStyle = "#333";
            ctx.font = "bold 12px Helvetica";
            ctx.fillText(e.name, cx + Math.cos(rad) * (radius + 20) - 20, cy + Math.sin(rad) * (radius + 20));
        });
    }

    function saveImage() {
        const link = document.createElement('a');
        link.download = 'lingua_robotica_map.png';
        link.href = canvas.toDataURL();
        link.click();
    }
</script>
</body>
</html>
</script>
</body>
</html>
